<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Discord Web Pinger + Old Layout + Chat Status</title>
  <style>
    /* reset and basics */
    * {
      margin: 0; padding: 0; box-sizing: border-box; user-select: none;
    }
    body {
      background-color: #0e0e0e;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      gap: 20px;
      padding: 25px;
      position: relative;
      z-index: 0;
    }
    canvas#backgroundCanvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      user-select: none;
      background: #0e0e0e;
    }
    /* Main container layout: 3 columns */
    .panel {
      background: #111;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 18px rgba(88, 101, 242, 0.65);
      display: flex;
      flex-direction: column;
      gap: 14px;
      max-height: 670px;
      overflow-y: auto;
      flex-shrink: 0;
    }
    /* widths for each panel */
    .panel-left {
      width: 480px;
      flex-grow: 0;
    }
    .panel-middle {
      width: 360px;
      flex-grow: 0;
    }
    .panel-right {
      width: 360px;
      flex-grow: 0;
    }
    /* headings */
    h1, h2, h3 {
      font-weight: 700;
      letter-spacing: 1.2px;
      user-select: none;
    }
    h1 {
      font-size: 26px;
      margin-bottom: 12px;
    }
    h2 {
      font-size: 20px;
      margin-bottom: 10px;
    }
    /* inputs and textarea */
    label {
      font-size: 14px;
      margin-bottom: 6px;
      display: block;
    }
    input[type=text], textarea {
      background: #1a1a1a;
      border: 1px solid #444;
      color: white;
      padding: 12px 14px;
      font-size: 15px;
      border-radius: 6px;
      width: 100%;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    input[type=text]:focus, textarea:focus {
      outline: none;
      border-color: #5865f2;
      background: #222;
    }
    textarea.wordlist-textarea {
      min-height: 210px;
      max-height: 310px;
      font-family: monospace;
      white-space: pre-wrap;
      overflow-y: auto;
    }
    /* buttons */
    button {
      background: #5865f2;
      border: none;
      color: white;
      padding: 12px 0;
      font-weight: 700;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.25s ease;
      user-select: none;
    }
    button:hover:not(.active) {
      background: #4752c4;
    }
    button.active {
      background: #344ac7 !important;
    }
    /* controls container */
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .slider-container {
      flex-grow: 1;
      font-size: 13px;
      color: #bbb;
    }
    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 5px;
      background: #444;
      cursor: pointer;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #5865f2;
      border: 2px solid #333;
      cursor: pointer;
      transition: background 0.25s ease;
    }
    input[type=range]:hover::-webkit-slider-thumb {
      background: #4752c4;
    }
    .toggle-buttons {
      display: flex;
      gap: 10px;
      user-select: none;
    }
    .toggle-buttons button {
      background: #333;
      font-weight: 600;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 6px;
      border: 2px solid transparent;
      color: #ddd;
      cursor: pointer;
      white-space: nowrap;
    }
    .toggle-buttons button.active {
      background: #5865f2;
      border-color: #4752c4;
      color: white;
    }
    /* file upload */
    .file-upload {
      font-size: 14px;
      margin-top: 10px;
      user-select: none;
    }
    .file-upload input[type=file] {
      margin-top: 6px;
      cursor: pointer;
      width: 100%;
    }
    /* filter list */
    .filter-list {
      max-height: 190px;
      overflow-y: auto;
      background: #222;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
      user-select: text;
    }
    .filter-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      align-items: center;
      gap: 10px;
    }
    .filter-item div {
      flex-grow: 1;
      overflow-wrap: break-word;
    }
    .filter-item button {
      padding: 4px 10px;
      font-size: 13px;
      background: #722;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      color: white;
      user-select: none;
    }
    .filter-item button:hover {
      background: #a33;
    }
    input.filter-key, input.filter-reply {
      width: 100%;
      margin-bottom: 6px;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #1a1a1a;
      color: white;
      font-size: 14px;
    }
    /* chat activity status container */
    .chat-status {
      background: #111;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 0 18px rgba(88, 101, 242, 0.65);
      display: flex;
      flex-direction: column;
      max-height: 670px;
      overflow: hidden;
      color: #ddd;
      font-size: 13px;
    }
    .chat-status-header {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 10px;
      border-bottom: 1px solid #444;
      padding-bottom: 8px;
      user-select: none;
    }
    #messages {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 12px;
      padding-right: 6px;
    }
    #messages::-webkit-scrollbar {
      width: 8px;
    }
    #messages::-webkit-scrollbar-thumb {
      background: #5865f2;
      border-radius: 6px;
    }
    #messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .msg-entry {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 6px;
      background: #222;
      padding: 6px 12px;
      border-radius: 8px;
      user-select: text;
      word-wrap: break-word;
    }
    .msg-entry img {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      flex-shrink: 0;
      background: #444;
    }
    .msg-content {
      max-width: 240px;
    }
    .msg-username {
      font-weight: 700;
      font-size: 14px;
      color: #5865f2;
      margin-bottom: 3px;
    }
    .msg-text {
      font-size: 13px;
      white-space: pre-wrap;
      color: #ddd;
    }
    /* status info */
    .status-info {
      font-size: 13px;
      line-height: 1.4;
      user-select: none;
    }
    .status-info div {
      margin-bottom: 6px;
    }
    ul.status-list {
      list-style: inside disc;
      margin-top: 4px;
      margin-bottom: 8px;
      max-height: 65px;
      overflow-y: auto;
      padding-left: 16px;
    }
    ul.status-list li {
      margin-bottom: 2px;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <canvas id="backgroundCanvas"></canvas>

  <!-- Left panel: tokens, channel IDs, user IDs, message input -->
  <div class="panel panel-left">
    <h1>discord web pinger</h1>

    <label for="token">discord tokens (one per line)</label>
    <textarea id="token" placeholder="paste your discord tokens here" rows="5" spellcheck="false"></textarea>

    <label for="channelId">channel ids (one per line)</label>
    <textarea id="channelId" placeholder="paste target channel ids here" rows="3" spellcheck="false"></textarea>

    <label for="userId">user ids to ping (one per line)</label>
    <textarea id="userId" placeholder="paste user ids here" rows="3" spellcheck="false"></textarea>

    <div class="controls">
      <div class="slider-container" style="min-width: 160px;">
        <label for="speedRange">send speed: <span id="speedValue">1000</span> ms</label>
        <input type="range" id="speedRange" min="200" max="5000" step="100" value="1000" />
      </div>
      <div class="toggle-buttons" title="message style">
        <button id="btnBold" class="active">bold (#)</button>
        <button id="btnUnbold">unbold</button>
      </div>
    </div>

    <textarea id="message" placeholder="message to send" rows="6" spellcheck="false"></textarea>

    <div class="controls" style="justify-content: space-between; margin-top: 10px;">
      <button id="sendBtn" style="width: 48%;">send message</button>
      <button id="autoToggleBtn" style="width: 48%;">start auto sending</button>
    </div>

    <div style="margin-top: 15px;">
      <label for="persistentMsgInput">persistent message (appended to every send):</label>
      <textarea id="persistentMsgInput" rows="3" placeholder="leave empty to disable" spellcheck="false"></textarea>
      <button id="clearPersistentBtn" style="margin-top: 6px; background: #a33; width: 100%;">remove persistent message</button>
    </div>

    <div style="margin-top: 15px;">
      <label>ping position:</label>
      <div class="toggle-buttons" style="justify-content: center;">
        <button id="pingStart" class="active">ping at start</button>
        <button id="pingEnd">ping at end</button>
      </div>
    </div>

    <div style="margin-top: 15px;">
      <button id="emojiAddBtn" style="width: 48%;">add emoji</button>
      <button id="emojiRemoveBtn" style="width: 48%; display:none; background:#a33;">remove emoji</button>
    </div>

    <div style="margin-top: 15px;">
      <label for="colorWheel">choose website color</label>
      <input type="color" id="colorWheel" value="#5865f2" />
      <label for="glowColorWheel" style="margin-top: 8px;">choose glow color</label>
      <input type="color" id="glowColorWheel" value="#5865f2" />
    </div>
  </div>

  <!-- Middle panel: wordlist, file upload -->
  <div class="panel panel-middle">
    <h2>wordlist / auto sender</h2>
    <label for="wordlistArea">paste or type wordlist (lines will send sequentially):</label>
    <textarea id="wordlistArea" class="wordlist-textarea" spellcheck="false" placeholder="example:\nhello\nworld\nfoo\nbar"></textarea>

    <label class="file-upload" for="fileInput">or upload a .txt file:</label>
    <input type="file" id="fileInput" accept=".txt" />
  </div>

  <!-- Right panel: filters + chat activity/status HUD -->
  <div class="panel panel-right">
    <h2>filters</h2>
    <label for="filterKeyword">keyword to detect:</label>
    <input id="filterKeyword" type="text" placeholder="e.g. loser" autocomplete="off" spellcheck="false" class="filter-key" />
    <label for="filterReply">reply to send:</label>
    <input id="filterReply" type="text" placeholder="e.g. i'm not a loser" autocomplete="off" spellcheck="false" class="filter-reply" />
    <button id="addFilterBtn" style="margin-bottom: 12px;">add filter</button>

    <div class="filter-list" id="filterList"></div>

    <div class="chat-status" style="margin-top: 18px; flex-grow: 1;">
      <div class="chat-status-header">chat activity status</div>
      <div id="messages"></div>
      <div class="status-info">
        <div><b>rate limited:</b> <span id="rateLimited">no</span></div>
        <div><b>active tokens:</b>
          <ul id="activeTokens" class="status-list"></ul>
        </div>
        <div><b>active channels:</b>
          <ul id="activeChannels" class="status-list"></ul>
        </div>
        <div><b>active userids:</b>
          <ul id="activeUserIds" class="status-list"></ul>
        </div>
        <div><b>ping (ms):</b> <span id="pingMs">-</span></div>
        <div><b>current server:</b> <span id="currentServer">-</span></div>
        <div><b>current channel:</b> <span id="currentChannel">-</span></div>
        <div><b>current time:</b> <span id="currentTime">-</span></div>
        <div><b>IP info:</b> <span id="ipInfo">loading...</span></div>
      </div>
    </div>
  </div>

  <script>
    // starfield background - same as before
    const canvas = document.getElementById('backgroundCanvas');
    const ctx = canvas.getContext('2d');
    let stars = [];
    let starCount = 120;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Star {
      constructor() {
        this.reset();
      }
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 1.2 + 0.3;
        this.speed = (this.size * 0.2) + 0.1;
        this.alpha = Math.random() * 0.8 + 0.2;
        this.twinkleSpeed = Math.random() * 0.05 + 0.01;
        this.twinkleDirection = 1;
      }
      update() {
        this.x -= this.speed;
        if (this.x < 0) this.x = canvas.width;
        this.alpha += this.twinkleSpeed * this.twinkleDirection;
        if (this.alpha > 1) {
          this.alpha = 1;
          this.twinkleDirection = -1;
        } else if (this.alpha < 0.2) {
          this.alpha = 0.2;
          this.twinkleDirection = 1;
        }
      }
      draw() {
        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${this.alpha})`;
        ctx.shadowColor = "white";
        ctx.shadowBlur = 5;
        ctx.arc(this.x, this.y, this
      this.size, 0, Math.PI * 2);
      ctx.fill();
    }
    }

    function initStars() {
      stars = [];
      for(let i=0; i < starCount; i++) {
        stars.push(new Star());
      }
    }
    initStars();

    function animateStars() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      stars.forEach(star => {
        star.update();
        star.draw();
      });
      requestAnimationFrame(animateStars);
    }
    animateStars();

    // MAIN SCRIPT VARIABLES
    const tokenArea = document.getElementById('token');
    const channelArea = document.getElementById('channelId');
    const userArea = document.getElementById('userId');
    const messageArea = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const autoToggleBtn = document.getElementById('autoToggleBtn');
    const speedRange = document.getElementById('speedRange');
    const speedValue = document.getElementById('speedValue');
    const boldBtn = document.getElementById('btnBold');
    const unboldBtn = document.getElementById('btnUnbold');
    const pingStartBtn = document.getElementById('pingStart');
    const pingEndBtn = document.getElementById('pingEnd');
    const emojiAddBtn = document.getElementById('emojiAddBtn');
    const emojiRemoveBtn = document.getElementById('emojiRemoveBtn');
    const colorWheel = document.getElementById('colorWheel');
    const glowColorWheel = document.getElementById('glowColorWheel');
    const persistentMsgInput = document.getElementById('persistentMsgInput');
    const clearPersistentBtn = document.getElementById('clearPersistentBtn');

    const wordlistArea = document.getElementById('wordlistArea');
    const fileInput = document.getElementById('fileInput');

    const filterKeyword = document.getElementById('filterKeyword');
    const filterReply = document.getElementById('filterReply');
    const addFilterBtn = document.getElementById('addFilterBtn');
    const filterList = document.getElementById('filterList');

    const messagesDiv = document.getElementById('messages');
    const rateLimitedSpan = document.getElementById('rateLimited');
    const activeTokensList = document.getElementById('activeTokens');
    const activeChannelsList = document.getElementById('activeChannels');
    const activeUserIdsList = document.getElementById('activeUserIds');
    const pingMsSpan = document.getElementById('pingMs');
    const currentServerSpan = document.getElementById('currentServer');
    const currentChannelSpan = document.getElementById('currentChannel');
    const currentTimeSpan = document.getElementById('currentTime');
    const ipInfoSpan = document.getElementById('ipInfo');

    // State vars
    let autoSending = false;
    let sendIntervalId = null;
    let currentWordIndex = 0;
    let wordlist = [];
    let filters = [];
    let isBold = true;
    let pingPosition = 'start'; // or 'end'
    let emojiAdded = false;
    let rateLimited = false;

    // Helpers
    function logMessage(username, avatarUrl, text) {
      const entry = document.createElement('div');
      entry.classList.add('msg-entry');

      const avatar = document.createElement('img');
      avatar.src = avatarUrl || 'https://cdn.discordapp.com/embed/avatars/0.png'; // default discord avatar
      avatar.alt = username;
      entry.appendChild(avatar);

      const content = document.createElement('div');
      content.classList.add('msg-content');

      const userElem = document.createElement('div');
      userElem.classList.add('msg-username');
      userElem.textContent = username;

      const textElem = document.createElement('div');
      textElem.classList.add('msg-text');
      textElem.textContent = text;

      content.appendChild(userElem);
      content.appendChild(textElem);
      entry.appendChild(content);

      messagesDiv.appendChild(entry);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Toggles for bold/unbold
    function setBold(active) {
      isBold = active;
      if(isBold){
        boldBtn.classList.add('active');
        unboldBtn.classList.remove('active');
      } else {
        boldBtn.classList.remove('active');
        unboldBtn.classList.add('active');
      }
    }
    boldBtn.addEventListener('click', () => setBold(true));
    unboldBtn.addEventListener('click', () => setBold(false));

    // Ping position toggle
    function setPingPosition(pos) {
      pingPosition = pos;
      if(pos === 'start') {
        pingStartBtn.classList.add('active');
        pingEndBtn.classList.remove('active');
      } else {
        pingStartBtn.classList.remove('active');
        pingEndBtn.classList.add('active');
      }
    }
    pingStartBtn.addEventListener('click', () => setPingPosition('start'));
    pingEndBtn.addEventListener('click', () => setPingPosition('end'));

    // Emoji add/remove buttons
    emojiAddBtn.addEventListener('click', () => {
      emojiAdded = true;
      emojiAddBtn.style.display = 'none';
      emojiRemoveBtn.style.display = 'inline-block';
    });
    emojiRemoveBtn.addEventListener('click', () => {
      emojiAdded = false;
      emojiAddBtn.style.display = 'inline-block';
      emojiRemoveBtn.style.display = 'none';
    });

    // Speed slider update
    speedRange.addEventListener('input', () => {
      speedValue.textContent = speedRange.value;
    });

    // Color wheel handlers
    colorWheel.addEventListener('input', () => {
      document.body.style.backgroundColor = colorWheel.value;
    });
    glowColorWheel.addEventListener('input', () => {
      const glowColor = glowColorWheel.value;
      document.querySelectorAll('.panel').forEach(panel => {
        panel.style.boxShadow = `0 0 18px ${glowColor}`;
      });
    });

    // Clear persistent message
    clearPersistentBtn.addEventListener('click', () => {
      persistentMsgInput.value = '';
    });

    // File upload for wordlist
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if(!file) return;
      if(file.type !== 'text/plain'){
        alert('Only .txt files are allowed');
        return;
      }
      const reader = new FileReader();
      reader.onload = function(evt) {
        wordlistArea.value = evt.target.result;
        updateWordlist();
      };
      reader.readAsText(file);
      // reset file input so same file can be re-uploaded if needed
      fileInput.value = '';
    });

    // Update wordlist array from textarea
    function updateWordlist() {
      wordlist = wordlistArea.value.split('\n').filter(line => line.trim().length > 0);
      currentWordIndex = 0;
    }
    wordlistArea.addEventListener('input', updateWordlist);

    // FILTERS MANAGEMENT
    addFilterBtn.addEventListener('click', () => {
      const key = filterKeyword.value.trim();
      const reply = filterReply.value.trim();
      if(!key || !reply){
        alert('both keyword and reply are required');
        return;
      }
      filters.push({key, reply});
      renderFilters();
      filterKeyword.value = '';
      filterReply.value = '';
    });

    function renderFilters() {
      filterList.innerHTML = '';
      filters.forEach((filter, idx) => {
        const item = document.createElement('div');
        item.classList.add('filter-item');
        const keyDiv = document.createElement('div');
        keyDiv.textContent = filter.key;
        const replyDiv = document.createElement('div');
        replyDiv.textContent = filter.reply;
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'remove';
        removeBtn.addEventListener('click', () => {
          filters.splice(idx, 1);
          renderFilters();
        });
        item.appendChild(keyDiv);
        item.appendChild(replyDiv);
        item.appendChild(removeBtn);
        filterList.appendChild(item);
      });
    }

    // Send a single message logic (simulate sending)
    function sendMessage(text) {
      if(!text.trim()) return;

      // Compose final message with ping and persistent message
      const tokens = tokenArea.value.split('\n').filter(t => t.trim() !== '');
      const userIds = userArea.value.split('\n').filter(u => u.trim() !== '');
      if(tokens.length === 0) {
        alert('Please enter at least one token');
        return;
      }
      if(userIds.length === 0) {
        alert('Please enter at least one user ID to ping');
        return;
      }

      // Compose pings with correct position and formatting
      let pingPart = userIds.map(id => `<@${id}>`).join(' ');
      if(isBold) pingPart = `**${pingPart}**`;

      let finalMsg = text;
      if(pingPosition === 'start') {
        finalMsg = emojiAdded ? `ðŸ”¹ ${pingPart} ${text}` : `${pingPart} ${text}`;
      } else {
        finalMsg = emojiAdded ? `${text} ðŸ”¹ ${pingPart}` : `${text} ${pingPart}`;
      }
      if(persistentMsgInput.value.trim()) {
        finalMsg += '\n' + persistentMsgInput.value.trim();
      }

      // Log the message for now (simulate send)
      logMessage('You', null, finalMsg);

      // In real usage, here you'd send the message through API calls with tokens etc.

      return finalMsg;
    }

    // Send button handler
    sendBtn.addEventListener('click', () => {
      const msgText = messageArea.value.trim();
      if(!msgText) return;
      sendMessage(msgText);
      messageArea.value = '';
    });

    // Enter key sends message + clears textarea
    messageArea.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendBtn.click();
      }
    });

    // AUTO SENDING logic
    autoToggleBtn.addEventListener('click', () => {
      if(autoSending) {
        stopAutoSend();
      } else {
        startAutoSend();
      }
    });

    function startAutoSend() {
      updateWordlist();
      if(wordlist.length === 0) {
        alert('Wordlist is empty');
        return;
      }
      autoSending = true;
      autoToggleBtn.textContent = 'stop auto sending';
      sendIntervalId = setInterval(() => {
        if(currentWordIndex >= wordlist.length) {
          currentWordIndex = 0; // loop wordlist
        }
        sendMessage(wordlist[currentWordIndex]);
        currentWordIndex++;
      }, parseInt(speedRange.value));
    }
    function stopAutoSend() {
      autoSending = false;
      autoToggleBtn.textContent = 'start auto sending';
      if(sendIntervalId) clearInterval(sendIntervalId);
    }

    // Update UI with dummy data for chat status info (you can replace this with real data)
    function updateStatusInfo() {
      rateLimitedSpan.textContent = rateLimited ? 'yes' : 'no';
      // just demo tokens/channels/userids lists from current inputs
      activeTokensList.innerHTML = '';
      tokenArea.value.split('\n').filter(t => t.trim() !== '').forEach(t => {
        const li = document.createElement('li');
        li.textContent = t.substring(0, 20) + (t.length > 20 ? '...' : '');
        activeTokensList.appendChild(li);
      });
      activeChannelsList.innerHTML = '';
      channelArea.value.split('\n').filter(c => c.trim() !== '').forEach(c => {
        const li = document.createElement('li');
        li.textContent = c;
        activeChannelsList.appendChild(li);
      });
      activeUserIdsList.innerHTML = '';
      userArea.value.split('\n').filter(u => u.trim() !== '').forEach(u => {
        const li = document.createElement('li');
        li.textContent = u;
        activeUserIdsList.appendChild(li);
      });
      pingMsSpan.textContent = '-'; // placeholder
      currentServerSpan.textContent = '-';
      currentChannelSpan.textContent = '-';
      currentTimeSpan.textContent = new Date().toLocaleTimeString();
      ipInfoSpan.textContent = 'loading...';
    }

    setInterval(updateStatusInfo, 1000);

    // Fetch IP info once
    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(data => {
        ipInfoSpan.textContent = data.ip;
      }).catch(() => {
        ipInfoSpan.textContent = 'error fetching IP';
      });

  </script>
</body>
</html>
